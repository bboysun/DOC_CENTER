## èŠèŠFeginæœåŠ¡æ²»ç†

Feginå¯ä»¥è®©å¼€å‘è€…é€šè¿‡æ³¨è§£çš„æ–¹å¼è½»æ¾å®ç°å¾®æœåŠ¡ä¸­å„ä¸ªç»„ä»¶çš„è¿œç¨‹è°ƒç”¨ï¼Œå¤§å¤§çš„ç®€åŒ–äº†æˆ‘ä»¬çš„ä»£ç ç¼–å†™ã€‚è¿™å°±æ˜¯ä»–è¯ç”Ÿçš„åˆè¡·ã€‚

#### ä¸€ã€å‚æ•°ç»‘å®š

æˆ‘ä»¬å¸¸ç”¨çš„Spring MVCçš„æ³¨è§£éƒ½å¯ä»¥åœ¨Feginä¸­æ­£å¸¸ä½¿ç”¨æ¥è¾¾åˆ°è¿œç¨‹è°ƒç”¨å…¶ä»–åº”ç”¨æœåŠ¡åœ¨Eurekaä¸­æš´éœ²çš„æ¥å£ã€‚

* @RequestParam: ç»‘å®šå•ä¸ªè¯·æ±‚å‚æ•°å€¼ã€‚
* @PathVariable:ç»‘å®šURIæ¨¡ç‰ˆå˜é‡å€¼ã€‚
* @RequestHeader:ç»‘å®šè¯·æ±‚å¤´æ•°æ®ã€‚
* @RequestBody:ç»‘å®šè¯·æ±‚å†…å®¹è‡ªå®šä¹‰ç±»æ•°æ®å¹¶èƒ½è‡ªåŠ¨ç±»å‹è½¬æ¢ã€‚

å…¶ä¸­å‰ä¸‰ä¸ªå‚æ•°çš„ç»‘å®šæ³¨è§£ä¸­çš„valueæ˜¯**ä¸èƒ½å°‘**çš„ã€‚ç¬¬å››ä¸ªå‚æ•°ä¼ é€’è¿‡ç¨‹ä¸­ï¼Œè‡ªå®šä¹‰ç±»å¿…é¡»è¦æœ‰é»˜è®¤çš„æ„é€ å‡½æ•°ï¼Œå¦åˆ™Feginæ— æ³•å°†Jsonå­—ç¬¦ä¸²è½¬æ¢ä¸ºå¯¹è±¡ï¼Œä¼šé€ æˆè°ƒç”¨ä¸æˆåŠŸã€‚

å¯¹ä¸€ä¸ªæ¥å£åŠ ä¸ŠFeginClientæ³¨è§£ï¼ŒåŒæ—¶valueå‚æ•°æŒ‡å‘æä¾›æ¥å£çš„æœåŠ¡IDï¼ˆè¿™ä¸ªIDå°±æ˜¯æˆ‘ä»¬åœ¨Eurekaä¸­çœ‹åˆ°Applicationåå­—ï¼‰ï¼Œå†åŠ ä¸Šä¸Šé¢çš„æ³¨è§£æ„å»ºå’ŒæœåŠ¡æä¾›è€…ç›¸åŒçš„URIè·¯å¾„ï¼Œå°±å¯ä»¥è½»æ¾æå®šè¿œç¨‹è°ƒç”¨æ¥å£ã€‚

å…·ä½“çœ‹ä¸‹ä»£ç å¦‚ä¸‹ï¼š

```java
/**
 * @Auther: Darryl
 * @Description: call remote interface,
 * PRODUCER-A is all uppercase
 * /hello/{name} is full uri path
 * @Date: created in 2020/4/1 21:16
 */
@FeignClient(value = "PRODUCER-A", fallback = RemoteSayHelloFallBack.class)
public interface RemoteSayHelloService {
    @GetMapping(value = "/hello/{name}")
    String remoteSayHello(@PathVariable("name") String name);

    @PostMapping(value = "/hello/userSay")
    String remoteUserSayHello(@RequestBody UserModel user);
}
```

å½“ç„¶ä¸Šé¢æåˆ°çš„æ˜¯æ­£å¸¸çš„è°ƒç”¨è¯·æ±‚ï¼Œä¸€æ—¦æœåŠ¡æä¾›è€…å¼‚å¸¸äº†ï¼Œæ¯”å¦‚è¡¨è¢«ğŸ”’äº†ï¼Œè¿™ä¸ªè¯·æ±‚ä¸€ç›´è¢«å¡ä½ï¼Œå¯¼è‡´è¯·æ±‚è¢«æŒ‚èµ·ï¼Œè¿Ÿè¿Ÿå¾—åˆ°ä¸å“åº”å°±éº»çƒ¦äº†ã€‚ä¸ç”¨æ‹…å¿ƒï¼ŒFeginä¸ºæˆ‘ä»¬å·²ç»æƒ³å¥½çš„è§£å†³æ–¹æ¡ˆï¼Œæˆ‘ä»¬æ¥ç€çœ‹ã€‚

#### äºŒã€å¼‚å¸¸fallback

Feginç»„ä»¶å…¶å®æ˜¯æ•´åˆäº†Hytrixç»„ä»¶çš„ï¼ˆè¿™ä¸ªæˆ‘ä»¬åé¢ç»†è¯´ï¼Œç®€å•ç†è§£æ˜¯ä¸€ä¸ªç†”æ–­å™¨ï¼‰å¯ä»¥è½»æ¾åšåˆ°æœåŠ¡è¯·æ±‚çš„å›é€€åŠŸèƒ½ã€‚

å½“ç„¶æˆ‘ä»¬è¦åœ¨æœåŠ¡æ¶ˆè´¹åº”ç”¨ä¸­å®ç°è¿œç¨‹è°ƒç”¨æ¥å£çš„å®ç°ç±»ã€‚æˆ‘ä»¬å¯ä»¥åœ¨æœåŠ¡æ¶ˆè´¹åº”ç”¨ä¸­è‡ªå·±å…·ä½“çš„å®ç°å¯¹åº”çš„è¿œç¨‹è°ƒç”¨æ¥å£çš„æ–¹æ³•ã€‚

```java
/**
 * @Auther: Darryl
 * @Description: when occur hystrix, need fall back
 * @Date: created in 2020/4/4 13:46
 */
@Component
public class RemoteSayHelloFallBack implements RemoteSayHelloService {

    @Override
    public String remoteSayHello(String name) {
        return this.remoteSayHelloFallBack(name);
    }

    @Override
    public String remoteUserSayHello(UserModel user) {
        return this.remoteUserSayHelloFallBack(user);
    }

    // fall back method
    protected String remoteSayHelloFallBack(String name) {
        return "fall back is " + name + " say Hello~~~";
    }

    // fall back method
    protected String remoteUserSayHelloFallBack(UserModel user) {
        return "fall back is " + user.getName() + " is age: " + user.getAge() + " say Hello~~";
    }
}
```

ä¸Šé¢çš„å®ç°ç±»å®Œæˆåï¼Œå½“ç„¶è¿˜æ˜¯ä¸å¤Ÿçš„ï¼Œéœ€è¦åœ¨è¿œç¨‹æ‰ç”¨æ¥å£ä¸Šçš„@FeginClientæ³¨è§£ä¸­æ·»åŠ fallbackå‚æ•°æŒ‡å®šåˆ°fallbackå®ç°ç±»ã€‚è¿™æ ·è¿œç¨‹è°ƒç”¨æ¥å£åœ¨å‘ç°æœåŠ¡æä¾›è€…å‡ºç°å¼‚å¸¸åï¼Œå°±ä¼šè°ƒç”¨åˆ°æœ¬åœ°fallbackå®ç°ç±»æ–¹æ³•ï¼Œé¿å…äº†å¼‚å¸¸å°†è¯·æ±‚æŒ‚èµ·ã€‚

```java
@FeignClient(value = "PRODUCER-A", fallback = RemoteSayHelloFallBack.class)
```

åŒæ—¶æˆ‘ä»¬ä¹Ÿæ˜¯éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­å¼€å¯hystrixã€‚

```yaml
# feign enable hystrix
feign:
  hystrix:
    enabled: true
```

è¿™æ ·å°±å¯ä»¥å®Œç¾è§£å†³å¾®æœåŠ¡ä¸­çš„è¿œç¨‹è°ƒç”¨ã€‚

#### ä¸‰ã€å®æˆ˜

å…·ä½“çš„å®ç°å¯ä»¥å‚è€ƒæˆ‘çš„githubä¸Šæœ‰è¯¦ç»†çš„ä»£ç ã€‚

è¯¦è§ï¼šhttps://github.com/bboysun/springcloud

å¦‚æœè§‰å¾—æœ‰å¸®åŠ©ï¼Œè®°å¾—ç•™ä¸‹å®è´µçš„STAR :star2:

